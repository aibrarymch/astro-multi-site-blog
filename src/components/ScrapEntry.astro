---
interface Props {
  datetime?: string;
  title?: string;
}

const { datetime, title } = Astro.props;

const showTitle = !!title;

let formattedDate = '';
let formattedTime = '';
if (datetime) {
  const date = new Date(datetime);
  formattedDate = date.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
  formattedTime = date.toLocaleTimeString('ja-JP', {
    hour: '2-digit',
    minute: '2-digit',
  });
}

const entryId = title
  ? `entry-${title.replace(/[\s:]/g, '-')}`
  : `entry-${datetime!.replace(/[:\s]/g, '-')}`;
---

<div
  class="scrap-entry"
  id={entryId}
  {...(datetime ? { 'data-datetime': datetime } : {})}
  {...(title ? { 'data-title': title } : {})}
>
  <div class="entry-card">
    <div class="entry-header">
      {showTitle ? (
        <>
          <span class="entry-title">{title}</span>
          {datetime && (
            <time datetime={datetime}>
              {formattedDate} {formattedTime}
            </time>
          )}
        </>
      ) : (
        <time datetime={datetime}>
          {formattedDate} {formattedTime}
        </time>
      )}
    </div>
    <div class="entry-content">
      <slot />
    </div>
  </div>
</div>

<style>
.scrap-entry {
  margin-bottom: 24px;
  position: relative;
  padding-left: 24px;
}

.scrap-entry::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: -24px;
  width: 3px;
  background: var(--border);
}

.scrap-entry:last-child::before {
  bottom: 0;
}

.scrap-entry::after {
  content: '';
  position: absolute;
  left: -4px;
  top: 50%;
  transform: translateY(-50%);
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--accent);
}

.entry-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  padding: 20px;
  box-shadow: var(--shadow-soft);
}

.entry-header time,
.entry-header .entry-title {
  font-size: 0.85rem;
  color: var(--text-secondary);
  font-weight: 500;
}

.entry-header .entry-title {
  font-weight: 700;
  color: var(--text-primary);
}

.entry-content {
  margin-top: 12px;
  line-height: 1.8;
}

.entry-content :global(p:first-child) {
  margin-top: 0;
}

.entry-content :global(p:last-child) {
  margin-bottom: 0;
}

.entry-content :global(pre) {
  margin: 16px 0;
  padding: 16px;
  background: var(--bg-code);
  border: 1px solid var(--border-code);
  border-radius: var(--radius-md);
  overflow-x: auto;
}

.entry-content :global(pre code) {
  font-size: 1em;
  line-height: 1.5;
  font-family: 'Fira Code', 'Source Code Pro', monospace;
  color: var(--text-code);
  background: transparent;
  border: none;
  padding: 0;
}

.entry-content :global(ul),
.entry-content :global(ol) {
  margin: 8px 0;
  padding-left: 1.5em;
}

.entry-content :global(li) {
  margin: 4px 0;
}

.entry-content :global(:not(pre) > code) {
  background: var(--bg-code-inline);
  color: var(--text-code-inline);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-code);
  padding: 0.1em 0.45em;
  font-family: 'Fira Code', 'Source Code Pro', monospace;
  font-size: 0.9em;
}
</style>
